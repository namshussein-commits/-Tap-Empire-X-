<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tap Empire X</title>
<style>
body{margin:0;font-family:Arial;background:radial-gradient(circle,#111,#000);color:white;text-align:center;overflow:hidden;}
.container{padding:20px;}
h1{animation:pulse 2s infinite;}
button{width:80%;padding:16px;margin:8px;font-size:18px;border:none;border-radius:18px;background:linear-gradient(45deg,#ff9800,#ffc107);color:black;box-shadow:0 6px 18px rgba(255,152,0,.5);transition:transform .1s;}
button:active{transform:scale(0.92);}
#coins,#gems{font-size:32px;margin:10px;}
.coin,.gem{position:absolute;font-size:22px;animation:fly 1s forwards;}
.flash{animation:flash .4s;}
#luckyBox{position:absolute;font-size:40px;top:40%;left:50%;transform:translate(-50%,-50%);display:none;cursor:pointer;animation:boxAnim 1s infinite alternate;}
#map{display:grid;grid-template-columns:repeat(12,50px);gap:3px;margin:20px auto;}
.tile{width:50px;height:50px;background:#228B22;border:1px solid #555;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;transition:all .2s;}
@keyframes fly{from{opacity:1;transform:translateY(0) scale(1);}to{opacity:0;transform:translateY(-140px) scale(1.6);}}
@keyframes flash{0%{background:#000}50%{background:#332200}100%{background:#000}}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
@keyframes boxAnim{0%{transform:translate(-50%,-50%) scale(1)}100%{transform:translate(-50%,-50%) scale(1.2)}}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ”¥ Tap Empire X</h1>
<div id="coins">ğŸ’° 0</div>
<div id="gems">ğŸ’ 0</div>
<button onclick="tap()">ğŸ‘† Ø§Ù†Ù‚Ø±</button>
<button onclick="upgrade()">ğŸ—ï¸ ØªØ·ÙˆÙŠØ±</button>
<button onclick="toggleMusic()">ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰</button>
<button onclick="watchAd()">ğŸ“º Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù† + Ù…ÙƒØ§ÙØ£Ø©</button>
<div>Ø¯Ø®Ù„/Ø«Ø§Ù†ÙŠØ©: <span id="income">0</span></div>
<div id="map"></div>
</div>

<div id="luckyBox" onclick="claimLuckyBox()">ğŸ</div>

<audio id="bgm" src="music.mp3" loop></audio>
<audio id="tapS" src="tap.mp3"></audio>
<audio id="upS" src="upgrade.mp3"></audio>
<audio id="boxS" src="boxS.mp3"></audio>

<script>
let coins=0,gems=0,income=0,musicOn=false,fps=60,lastUpdate=performance.now();
let mapData=[];

// FPS
function setFPS(f){fps=f;}

// Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
function toggleMusic(){let m=document.getElementById("bgm");musicOn=!musicOn;musicOn?m.play():m.pause();}

// Coins / Gems
function tap(){coins++;play("tapS");spawnCoin(document.body);updateResources();}
function upgrade(){income+=10;coins-=Math.floor(coins*0.1);play("upS");flash();updateResources();}

// Ads
function watchAd(){let reward=Math.random();if(reward<0.5){coins+=100;}else{gems+=1;}play("boxS");updateResources();}

// ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸
function showLuckyBox(){let lb=document.getElementById("luckyBox");lb.style.display="block";setTimeout(()=>{lb.style.display="none";},20000);}
function claimLuckyBox(){let lb=document.getElementById("luckyBox");lb.style.display="none";let reward=Math.random();if(reward<0.6){coins+=200;}else{gems+=2;}play("boxS");updateResources();}
setInterval(showLuckyBox,600000); // ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚

// Ø§Ù„Ø®Ø±ÙŠØ·Ø©
const rows=12,cols=12;
let icons=["ğŸŒ³","ğŸ ","ğŸ°","ğŸ­","ğŸ’"];
for(let i=0;i<rows*cols;i++){
  let div=document.createElement("div");div.className="tile";div.innerText=icons[0];div.onclick=()=>upgradeTile(i);document.getElementById("map").appendChild(div);
  mapData.push({level:0,type:"tree",el:div});
}
function upgradeTile(i){let tile=mapData[i];if(tile.level<4){tile.level++;tile.el.innerText=icons[tile.level];coins+=tile.level*10;spawnCoin(tile.el);updateResources();}}

// Coins/Gems ØªØ·ÙŠØ±
function spawnCoin(el){let c=document.createElement("div");c.className="coin";c.innerText="ğŸ’°";document.body.appendChild(c);let rect=el.getBoundingClientRect();c.style.left=rect.left+"px";c.style.top=rect.top+"px";setTimeout(()=>c.remove(),1000);}
function spawnGem(el){let g=document.createElement("div");g.className="gem";g.innerText="ğŸ’";document.body.appendChild(g);let rect=el.getBoundingClientRect();g.style.left=rect.left+"px";g.style.top=rect.top+"px";setTimeout(()=>g.remove(),1000);}

// Ù…Ø¤Ø«Ø±Ø§Øª
function flash(){document.body.classList.add("flash");setTimeout(()=>document.body.classList.remove("flash"),300);}
function play(id){let s=document.getElementById(id);s.currentTime=0;s.play();}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function loadData(){
    coins = parseInt(localStorage.getItem("coins")) || 0;
    gems = parseInt(localStorage.getItem("gems")) || 0;
    income = parseInt(localStorage.getItem("income")) || 0;
    updateResources();
}
function saveData(){
    localStorage.setItem("coins",coins);
    localStorage.setItem("gems",gems);
    localStorage.setItem("income",income);
}
window.onload = function(){
    loadData();
    setInterval(saveData,5000); // Ø­ÙØ¸ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
function updateResources(){document.getElementById("coins").innerText="ğŸ’° "+Math.floor(coins);document.getElementById("gems").innerText="ğŸ’ "+gems;}

// Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
function gameLoop(now){let delta=(now-lastUpdate)/1000;lastUpdate=now;coins+=income*delta;updateResources();setTimeout(()=>gameLoop(performance.now()),1000/fps);}
gameLoop(performance.now());
</script>
</body>
</html>
